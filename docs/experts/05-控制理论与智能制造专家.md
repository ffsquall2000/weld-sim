# 超声波金属焊接过程监控变量与控制策略深度分析

> **专家角色**：自动控制理论与智能制造专家，专注于焊接过程的在线监控和自适应控制

---

## 系统建模框架

超声波金属焊接可建模为一个**多输入多输出（MIMO）非线性时变系统**：

```
dx(t)/dt = f(x(t), u(t), w(t))    状态方程
y(t)     = g(x(t), v(t))           观测方程
z        = h(x(T))                  质量方程
```

其中：
- **x(t)** 状态向量（界面温度、塑性变形量、氧化物破碎程度等——不可直接测量）
- **u(t)** 控制输入向量（振幅、夹紧力、模式切换点）
- **w(t)** 过程扰动（材料批次、环境温度、焊头磨损）
- **y(t)** 可观测输出向量（传感器信号）
- **z** 终端质量指标（拉剥力、电阻等）

---

## 1. 可观测过程变量

### 1.1 实时功率曲线 P(t)

| 阶段 | 时间范围 | 功率行为 | 物理机制 |
|------|---------|---------|---------|
| 阶段I（摩擦起始） | 0 ~ t₁ | 快速上升 | 氧化层破碎，库仑摩擦主导 |
| 阶段II（稳态塑变） | t₁ ~ t₂ | 平台/缓慢上升 | 界面软化，塑性变形功主导 |
| 阶段III（过焊征兆） | t₂ ~ t₃ | 急剧上升/波动 | 材料过度软化，焊头刺入 |

- 采样率 1-10 kHz
- P(t) = V(t) × I(t) × cos(φ(t))
- **可观测性等级：高**

### 1.2 实时频率曲线 f(t)

```
f(t) = f₀ + Δf_load(t) + Δf_thermal(t) + Δf_aging
```

- 频率分辨率 ±1 Hz（20kHz 基频下精度 0.005%）
- 频率突变指示箔材撕裂或焊头打滑
- **可观测性等级：高**

### 1.3 实时阻抗/电流/电压

```
Z(t) = R_m(t) + jωL_m(t) + 1/(jωC_m(t)) + Z_load(t)
```

- 需要高速 ADC（>80kHz）进行波形级分析
- **可观测性等级：高**

### 1.4 焊头位移（塌陷量）d(t)

```
d(t) = d_elastic(t) + d_plastic(t) + d_squeeze(t)
```

塌陷速率的物理含义：
```
dd(t)/dt = K × P_interface(t) / σ_yield(T(t))
```

- 锂电池薄箔焊接总塌陷量可能只有 50-200 μm
- **可观测性等级：中高**

### 1.5 焊接力曲线 F(t)

- F(t) 既是控制输入也是被观测量
- 液压/气压系统力响应带宽 10-50 Hz，为慢变量通道
- **可控性等级：中**

### 1.6 焊接区温度

- 红外热像仪只能测表面（界面被焊头遮挡）
- 热电偶响应慢（~100ms），超声波环境干扰严重
- **可观测性等级：低**

### 1.7 振幅反馈信号

```
A_actual(t) = A_setpoint × G_system(f, Z_load) × η_coupling(t)
```

- 通常通过换能器反馈端间接估算
- **可观测性等级：中高**

### 1.8 声发射信号

- 频率范围 100 kHz ~ 1 MHz
- 携带界面微观事件信息
- **可观测性等级：中**

---

## 2. 过程特征提取

### 2.1 功率曲线积分（总能量）

```
E_total = ∫₀ᵀ P(t) dt
E_phase_i = ∫_{t_i}^{t_{i+1}} P(t) dt    （分段能量）
```

### 2.2 功率峰值及其出现时刻

- P_max = max{P(t)}
- t_peak / T（归一化峰值位置）与焊接强度强相关
- 峰值过早（<0.3）→ 过快退化
- 峰值过晚（>0.8）→ 能量耦合不充分

### 2.3 频率偏移量

```
Δf_max    = max|f(t) - f₀|          最大频偏
Δf_end    = f(T) - f(0)             终态频偏
Δf_rate   = max|df(t)/dt|           最大频率变化率
N_excursion = count{|f(t)-f₀| > threshold}   越限次数
```

### 2.4 塌陷速率与最终塌陷量

```
d_final：铜极耳目标 80-150 μm，铝极耳目标 60-120 μm
塌陷加速比 > 2.0 为过焊预警信号
```

### 2.5 统计特征

对每个信号提取均值、方差、偏度、峰度、线性趋势。构建特征矩阵 X ∈ R^{n×p}，典型维度 30-80 维。

### 2.6 时频分析特征

- **STFT**：分析频率成分随时间变化
- **小波变换**：多分辨率分析，捕捉瞬态事件
- **EMD**：非平稳信号分解为固有模态函数

---

## 3. 质量预测模型

### 3.1 输入变量体系

```
Layer 1（可控参数）: u = [A_set, F_set, E_set/t_set, trigger_mode, ramp_profile]
Layer 2（过程特征）: φ = [E_total, P_max, t_peak, Δf_max, d_final, ...]  (30-80 维)
Layer 3（环境状态）: ξ = [T_ambient, N_welds, batch_id, humidity, ...]
完整输入: X = [u; φ; ξ] ∈ R^d, d ≈ 40-100
```

### 3.2 输出变量

- 力学质量：F_peel（剥离力）、失效模式
- 电气质量：R_contact（接触电阻）
- 几何质量：焊印面积覆盖率、对称性、飞溅程度

### 3.3 关键影响因子排序（典型）

```
E_total (总能量)         ████████████████████  0.28
A_set  (振幅)           ███████████████████   0.25
d_final (最终塌陷量)     ████████████████      0.22
F_set  (夹紧力)         ███████████           0.15
P_max  (功率峰值)       ██████                0.06
Δf_max (最大频偏)       ████                  0.04
```

### 3.4 变量交互作用

```
振幅 A ──┬── × ── 功率 P ──── → ── 能量 E ──── → ── 界面温度 T
         │                                              │
夹紧力 F ─┘                                              ↓
         └──────── → ── 接触面积 ──── → ── 塌陷量 d ←──┘
```

A×F 和 A×E 的交互项在锂电池铜铝焊接中统计显著（p < 0.01）。

### 3.5 建模方法对比

| 方法 | 优势 | 劣势 | 适用场景 |
|------|------|------|---------|
| 多元线性回归 | 可解释性强 | 无法捕捉非线性 | 初步筛选 |
| 二阶响应面 | 捕捉交互效应 | 高阶不足 | DOE 分析 |
| 高斯过程（GPR） | 不确定性量化 | 计算量大 | 离线优化 |
| 随机森林/GBDT | 鲁棒、特征重要性 | 外推弱 | 在线预测 |
| 神经网络 | 强非线性拟合 | 数据需求大 | 大数据场景 |
| PINN | 融合物理约束 | 实现复杂 | 数字孪生 |

---

## 4. 自适应控制策略

### 4.1 分层闭环控制架构

```
┌─────────────────────────────────────────┐
│  Level 3: 批次级自适应                    │
│  时间尺度: 数十焊点                       │
│  (模型参数更新、目标值重校)                 │
├─────────────────────────────────────────┤
│  Level 2: 焊点级在线优化                  │
│  时间尺度: 单个焊接周期 (200ms ~ 1s)      │
│  (参数寻优、终止判据动态调整)               │
├─────────────────────────────────────────┤
│  Level 1: 实时闭环控制                    │
│  时间尺度: < 1ms                         │
│  (振幅闭环、频率PLL、功率限幅)             │
└─────────────────────────────────────────┘
```

**Level 2 智能终止判据：**
```
terminate_welding() when ANY of:
  (1) E(t) ≥ E_target               能量达标
  (2) d(t) ≥ d_target               塌陷量达标
  (3) P(t) > P_critical             功率越限保护
  (4) dd(t)/dt > v_critical         塌陷加速保护
  (5) |Δf(t)| > Δf_critical         频偏越限保护
  (6) t > t_max                     时间上限保护
```

### 4.2 换能器老化补偿

```
每 M 个焊接周期执行空载特征测试:
  1. 测量 f_r, Z_0, Q
  2. 计算偏移量
  3. 更新补偿参数: A_comp = A_set × (1 + k₁×ΔZ₀/Z₀_baseline)
  4. 超阈值 → 维护预警 / 停机更换
```

### 4.3 材料批次变化自适应

```
Step 1: MMD 分布漂移检测
Step 2: 迁移学习模型微调
Step 3: 参数重优化
Step 4: 渐进式参数切换（避免突变）
```

### 4.4 环境温度补偿

```
E_compensated = E_nominal × [1 + α_E × (T_amb - T_ref)]
F_compensated = F_nominal × [1 + α_F × (T_amb - T_ref)]
```

典型 α_E ≈ -0.005/°C（温度升高时减少能量）

### 4.5 焊头磨损补偿

软测量策略：
```
磨损指标 W_est = f(P_avg_trend, E_per_weld_trend, d_final_trend)
if W_est > W_threshold:
    A_set_new = A_set × (1 + k_w × W_est)
    E_set_new = E_set × (1 + k_e × W_est)
if W_est > W_critical:
    trigger_tip_replacement_alert()
```

---

## 5. 统计过程控制（SPC）

### 5.1 监控变量与控制图

| 监控变量 | 控制图类型 | 子组大小 |
|---------|----------|---------|
| 焊接能量 | X-bar-R | n=5 |
| 塌陷量 | X-bar-S | n=5 |
| 功率峰值 | EWMA | 单值 |
| 拉剥力 | X-bar-R | n=3~5 |
| 接触电阻 | I-MR | 单值 |
| 综合质量指数 | CUSUM | 单值 |

**多变量 SPC——Hotelling T² 控制图：**
```
T² = (x - μ̂)ᵀ Σ̂⁻¹ (x - μ̂)
```

### 5.2 CPK/PPK 目标值

| 质量指标 | LSL | USL | CPK 目标 | PPK 目标 |
|---------|-----|-----|---------|---------|
| 拉剥力 | 40N | - | ≥1.67 | ≥1.33 |
| 接触电阻 | - | 0.5mΩ | ≥1.67 | ≥1.33 |
| 塌陷量 | 50μm | 200μm | ≥1.33 | ≥1.0 |
| 焊印覆盖率 | 85% | - | ≥1.33 | ≥1.0 |

### 5.3 分层报警体系

```
Level 0 (正常):    所有信号在 μ ± 2σ 内
Level 1 (注意):    任一信号在 2σ ~ 3σ → 记录
Level 2 (警告):    超过 3σ 或触发 Western Electric 规则 → 标记增检
Level 3 (报警):    关键参数超规格限 或 T² > UCL → 停机调查
Level 4 (紧急):    安全参数越限 → 立即停机
```

### 5.4 趋势预警

- **CUSUM**：对 0.5σ~1.5σ 的持续漂移更敏感
- **EWMA**（λ=0.1~0.3）：适合检测小幅均值漂移
- **批次间漂移检测**：Page-Hinkley 变点检测、MMD 分布差异检测

---

## 6. 数据驱动参数优化

### 6.1 DOE 因子选择

**Phase 1 筛选实验（Plackett-Burman）：**
- 振幅、夹紧力、焊接能量、焊接时间、振幅渐升时间、预压时间、焊头纹理深度

**Phase 2 优化实验（CCD/Box-Behnken）：**
- 保留 3-4 个显著因子

**Phase 3 确认实验：** ≥30 焊点验证

### 6.2 多目标优化

```
min J(u) = [-F_peel(u), R_contact(u), damage_score(u)]
subject to:
    F_peel(u) ≥ F_min            强度下限
    R_contact(u) ≤ R_max         电阻上限
    d_final(u) ≤ d_max           塌陷量上限
    CPK(u) ≥ 1.33               过程能力约束
```

目标优先级：**安全性 >> 电气性能 ≥ 力学强度 > 外观**

### 6.3 推荐特征集（~50 维）

```
功率域 (12维): P_mean, P_std, P_max, P_min, t_peak_P, P_slope_phase1/2,
               E_total, E_phase1/2, P_kurtosis, P_skewness
频率域 (8维):  f_mean, f_std, Δf_max, Δf_end, f_slope, df_dt_max,
               f_excursion_count, f_settling_time
塌陷量域 (8维): d_final, d_rate_mean/max, d_onset_time, d_phase1/2,
                d_acceleration_max, d_jerk_max
力域 (4维):    F_mean, F_std, F_overshoot, F_settling_time
时频域 (10维): wavelet_energy_band1~5, dominant_freq_shift,
               spectral_entropy/centroid/bandwidth/rolloff
设定参数 (4维): A_set, F_set, E_set, t_weld
环境状态 (4维): T_ambient, N_since_tip_change, Z_0_latest, batch_encoded
```

### 6.4 数字孪生模型

**状态变量：**
```
x_DT = [
  T_interface,     # 界面温度
  A_contact,       # 真实接触面积
  d_plastic,       # 塑性变形量
  δ_oxide,         # 氧化层残余厚度
  δ_IMC,           # IMC 层厚度
  D_diffusion,     # 扩散深度
  A_actual,        # 焊头实际振幅
  f_resonance,     # 当前谐振频率
  η_coupling,      # 能量耦合效率
  h_knurl,         # 焊头纹理残余高度
  η_transducer,    # 换能器效率
  Q_factor,        # 系统品质因子
]
```

采用无迹卡尔曼滤波（UKF）进行状态估计。

---

## 综合分析

### 可控性 vs 可观测性

```
        可控性高                    可控性低
        ├── 振幅设定值              ├── 界面温度
        ├── 夹紧力设定值            ├── 氧化层破碎程度
        ├── 焊接时间/能量           ├── 真实接触面积
        ├── 触发模式                ├── IMC层厚度
        └── 渐升参数                └── 焊头磨损状态

        可观测性高                  可观测性低
        ├── 功率 P(t)              ├── 界面温度
        ├── 频率 f(t)              ├── 真实接触面积
        ├── 电压/电流              ├── 氧化层状态
        ├── 塌陷量 d(t)            ├── 扩散/IMC厚度
        └── 振幅反馈               └── 材料微观组织
```

### 核心控制挑战

1. **不完全可观测性：** 最关键的状态变量不能直接测量，需软测量和状态估计
2. **强非线性耦合：** A×F 对功率和塌陷量的交互影响高度非线性
3. **多时间尺度：** 从微秒级振动到数千次焊接的换能器老化，跨越 6 个数量级
4. **过程不可逆性：** 过焊不可修复，控制策略需保守性
5. **小样本高成本：** 破坏性测试导致标签稀缺，需半监督/迁移学习
6. **极薄箔材约束：** 参数窗口极窄，对精度和鲁棒性要求远高于一般焊接
